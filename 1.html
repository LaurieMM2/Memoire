<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Questionnaires</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.3/xlsx.full.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            height: 100vh;
            margin: 0;
        }

        .questionnaire-scale-info {
            text-align: center;
            font-size: 14px;
            font-style: italic;
            margin-bottom: 20px;
            color: #555;
        }
        .questionnaire-table {
            width: 100%;
            max-width: 900px;
            margin: 0 auto 30px auto;
            border-collapse: collapse;
        }

        .questionnaire-table th,
        .questionnaire-table td {
            border: 1px solid #ccc;
            padding: 10px;
            text-align: center;
            font-size: 14px;
        }

        .questionnaire-table th {
            background-color: #f0f0f0;
            font-weight: bold;
            padding: 15px;
        }

        .questionnaire-table td:first-child {
            text-align: left;
        }

        .questionnaire-instructions {
            font-size: 18px;
            font-weight: bold;
            background-color: #f9f9f9;
            padding: 15px;
            margin-bottom: 25px;
            border-radius: 6px;
        }
        .questionnaire-container {
            background: #ffffff;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            width: 100%;
            min-height: 100vh;
            padding: 30px 20px;
            text-align: center;
            display: none;
            box-sizing: border-box;
        }
        .submit-button {
            margin-top: 15px;
            padding: 12px;
            font-size: 16px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            width: 100%;
            font-weight: bold;
        }
        .submit-button2 {
            margin-top: 15px;
            padding: 12px;
            font-size: 16px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            width: 100%;
            font-weight: bold;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
        <button id="Btn" class="submit-button" onclick="endExperiment()">Commencer</button>
        <div id="questionnaireContainer" class="questionnaire-container">
            <form id="questionnaireForm">
                <button type="submit" class="submit-button2" onclick="generatePersonalityQuestionnaire()" style="margin-bottom: 30px;">
                    Soumettre le questionnaire
                </button>
                <div id="questionnaireItems"></div>
            </form>
        </div>
        <div id="finalMessage" style="display: none; font-size: 18px; font-weight: bold; margin-bottom: 20px;">
            Exp√©rience termin√©e, merci !
        </div>
        <div id="personalityContainer" class="questionnaire-container" style="display: none;">
            <form id="personalityForm">
                <div class="questionnaire-instructions">
                    Veuillez lire attentivement chaque √©nonc√© et √©valuez √† quel point cet √©nonc√© vous d√©crit.
                    <br><br>
                    1 = Total d√©saccord &nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp; 5 = Total accord
                </div>
                <div id="personalityItems"></div>
                <div style="text-align: center;">
                    <button type="submit" class="submit-button">Soumettre le questionnaire</button>
                </div>
            </form>
        </div>
        <div id="asdSsdContainer" class="questionnaire-container" style="display: none;">
            <form id="asdSsdForm">
                <div class="questionnaire-instructions">
                    Pour chaque √©nonc√©, indiquez dans quelle mesure vous √™tes d'accord :<br><br>
                    1 = Pas du tout d‚Äôaccord &nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp; 5 = Tout √† fait d‚Äôaccord
                </div>
                <div id="asdSsdItems"></div>
                <div style="text-align: center;">
                    <button type="submit" class="submit-button">Soumettre le questionnaire</button>
                </div>
            </form>
        </div>
        <div id="demographicContainer" class="questionnaire-container" style="display: none;">
            <form id="demographicForm">
                <div class="questionnaire-instructions">
                    Merci de r√©pondre aux questions suivantes :
                </div>

                <div style="margin-bottom: 15px;">
                    <label for="age"><strong>Quel est votre √¢ge ?</strong></label><br>
                    <input type="number" name="age" id="age" required>
                </div>

                <div style="margin-bottom: 15px;">
                    <label><strong>Quel est votre sexe ?</strong></label><br>
                    <label><input type="radio" name="sex" value="Homme" required> Homme</label>
                    <label><input type="radio" name="sex" value="Femme" required> Femme</label>
                    <label><input type="radio" name="sex" value="Autre" required> Autre</label>
                </div>

                <div style="margin-bottom: 15px;">
                    <label><strong>Niveau d'√©tudes :</strong></label><br>
                    <select name="education" required>
                        <option value="">--S√©lectionnez--</option>
                        <option value="Aucun dipl√¥me">Aucun dipl√¥me</option>
                        <option value="Coll√®ge">Coll√®ge</option>
                        <option value="Lyc√©e">Lyc√©e</option>
                        <option value="Bac">Bac</option>
                        <option value="Bac+2">Bac+2</option>
                        <option value="Bac+3">Bac+3</option>
                        <option value="Bac+5 ou plus">Bac+5 ou plus</option>
                    </select>
                </div>

                <div style="margin-bottom: 15px;">
                    <label><strong>√ätes-vous dyslexique ?</strong></label><br>
                    <label><input type="radio" name="dyslexic" value="Oui" required> Oui</label>
                    <label><input type="radio" name="dyslexic" value="Non" required> Non</label>
                    <label><input type="radio" name="dyslexic" value="Je ne sais pas"> Je ne sais pas</label>
                </div>

                <div style="text-align: center;">
                    <button type="submit" class="submit-button">Soumettre</button>
                </div>
            </form>
        </div>

        <button id="downloadBtn" class="submit-button" onclick="downloadExcel()" style="display: none;">
            T√©l√©charger les r√©sultats
        </button>
    </div>
    <script>
        const questionnaireItems = [
            "1. Avouer que vos go√ªts sont diff√©rents de ceux d‚Äôun ami.",
            "2. Aller camper en pleine nature.",
            "3. Parier une journ√©e de salaire aux courses de chevaux.",
            "4. Investir 10% de vos revenus annuels dans un fonds mutuel √† croissance mod√©r√©e.",
            "5. Boire abondamment lors d‚Äôune activit√© sociale.",
            "6. Tricher par un montant important dans votre d√©claration d‚Äôimp√¥t.",
            "7. √ätre en d√©saccord avec un symbole d‚Äôautorit√© sur une question importante.",
            "8. Parier une journ√©e de salaire lors d‚Äôune partie de poker √† enjeu important.",
            "9. Avoir une aventure avec un homme ou une femme mari√©(e).",
            "10. Pr√©senter le travail de quelqu‚Äôun d‚Äôautre comme √©tant le v√¥tre.",
            "11. Descendre une pente de ski exigeant une habilet√© plus grande que la v√¥tre.",
            "12. Investir 5% de vos revenus annuels dans des titres tr√®s sp√©culatifs.",
            "13. Faire de la descente en eau vive au printemps, quand le niveau de l‚Äôeau est √©lev√©.",
            "14. Parier une journ√©e de salaire sur le r√©sultat d‚Äôun √©v√©nement sportif.",
            "15. Avoir des relations sexuelles sans protection.",
            "16. R√©v√©ler le secret d‚Äôun ami √† un autre ami.",
            "17. Conduire une voiture sans porter de ceinture de s√©curit√©.",
            "18. Investir 10% de vos revenus annuels dans une nouvelle entreprise.",
            "19. Suivre un cours de parachutisme.",
            "20. Conduire une motocyclette sans casque protecteur.",
            "21. Choisir une carri√®re qui vous pla√Æt vraiment plut√¥t qu‚Äôune carri√®re s√©curitaire.",
            "22. Dire votre opinion sur une question controvers√©e lors d‚Äôune r√©union au travail.",
            "23. Vous faire bronzer sans √©cran solaire.",
            "24. Effectuer un saut √† l‚Äô√©lastique √† partir d‚Äôun pont √©lev√©.",
            "25. Piloter un petit avion.",
            "26. Rentrer chez vous √† pied le soir dans un quartier peu s√©curitaire.",
            "27. D√©m√©nager dans une ville √©loign√©e de votre famille.",
            "28. Entreprendre une nouvelle carri√®re au cours de la mi-trentaine.",
            "29. Laisser vos enfants seuls √† la maison pendant que vous faites une course.",
            "30. Ne pas retourner un portefeuille trouv√© contenant 200$."
        ];

        let questionnaireResponses = [];

        const personalityItems = [
            "1. Je suis le bout en train dans les partys.",
            "2. Je sympathise avec les sentiments des autres.",
            "3. J‚Äôaccomplis les t√¢ches m√©nag√®res sans d√©lai.",
            "4. J‚Äôai de fr√©quentes sautes d‚Äôhumeur.",
            "5. J‚Äôai une imagination fertile.",
            "6. Je ne parle pas beaucoup.",
            "7. Les probl√®mes des autres ne m'int√©ressent pas.",
            "8. J‚Äôoublie souvent de ranger les choses l√† o√π elles vont.",
            "9. Je suis d√©tendu la plupart du temps.",
            "10. Je n'ai pas d'int√©r√™t pour les id√©es abstraites.",
            "11. Je parle √† plusieurs personnes diff√©rentes dans les partys.",
            "12. Je ressens les √©motions des autres.",
            "13. J‚Äôaime l‚Äôordre.",
            "14. Je suis facilement contrari√©.",
            "15. J‚Äôai de la difficult√© √† comprendre les id√©es abstraites.",
            "16. J‚Äôai tendance √† rester en retrait.",
            "17. Je ne suis pas vraiment int√©ress√© par les autres.",
            "18. Je suis d√©sordonn√©.",
            "19. Je me sens rarement d√©prim√©.",
            "20. J‚Äôai tr√®s peu d‚Äôimagination."
        ];

        let personalityResponses = [];

        const asdSsdItems = [
            "1. Je pr√©f√®re m'appuyer sur les faits et les observations plut√¥t que sur mon intuition.",
            "2. Il m‚Äôarrive de penser que certains √©v√©nements ont une signification cach√©e.",
            "3. Je ressens peu d‚Äôint√©r√™t pour les interactions sociales.",
            "4. J‚Äôai tendance √† faire confiance √† mon instinct, m√™me sans preuve.",
            "5. Je remarque rapidement les petits d√©tails que les autres ne voient pas.",
            "6. Il m‚Äôarrive de croire que certaines co√Øncidences ne sont pas dues au hasard.",
            "7. Je suis mal √† l‚Äôaise dans les situations sociales.",
            "8. Je pense que mes croyances peuvent influencer la r√©alit√©.",
            "9. J‚Äôaime que les choses soient bien rang√©es et organis√©es.",
            "10. Il m‚Äôarrive d‚Äôavoir des pens√©es ou des perceptions √©tranges que je n‚Äôarrive pas √† expliquer."
        ];

        let asdSsdResponses = [];
        let demographicResponses = {};
        let results = [];
        let currentStep = 0;

        function generateQuestionnaire() {
            const container = document.getElementById("questionnaireItems");
            container.innerHTML = "";

            const instructions = `
                <div class="questionnaire-instructions">
                    Merci de r√©pondre au questionnaire suivant. Pour chaque √©nonc√©, indiquez √† quel point vous seriez susceptible d‚Äôagir ainsi :
                    <br><br>1 = Pas du tout risqu√© &nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp; 7 = Extr√™mement risqu√©
                </div>
            `;
            container.insertAdjacentHTML("beforebegin", instructions);

            let tableHTML = `
                <table class="questionnaire-table">
                    <thead>
                        <tr>
                            <th>Question</th>
                            ${[1, 2, 3, 4, 5, 6, 7].map(val => `<th>${val}</th>`).join('')}
                        </tr>
                    </thead>
                    <tbody>
                        ${questionnaireItems.map((question, index) => {
                            const id = `q${index + 1}`;
                            return `
                                <tr>
                                    <td><strong>${question}</strong></td>
                                    ${[1, 2, 3, 4, 5, 6, 7].map(val => `
                                        <td>
                                            <input type="radio" name="${id}" value="${val}" required>
                                        </td>
                                    `).join('')}
                                </tr>
                            `;
                        }).join('')}
                    </tbody>
                </table>
                <div style="text-align: center;">
                    <button type="submit" class="submit-button">
                        Soumettre le questionnaire
                    </button>
                </div>
            `;

            container.innerHTML = tableHTML;
        }

        function generatePersonalityQuestionnaire() {
            const container = document.getElementById("personalityItems");
            container.innerHTML = "";

            let tableHTML = `
                <table class="questionnaire-table">
                    <thead>
                        <tr>
                            <th>√ânonc√©</th>
                            ${[1, 2, 3, 4, 5].map(val => `<th>${val}</th>`).join('')}
                        </tr>
                    </thead>
                    <tbody>
                        ${personalityItems.map((question, index) => {
                            const id = `p${index + 1}`;
                            return `
                                <tr>
                                    <td><strong>${question}</strong></td>
                                    ${[1, 2, 3, 4, 5].map(val => `
                                        <td><input type="radio" name="${id}" value="${val}" required></td>
                                    `).join('')}
                                </tr>
                            `;
                        }).join('')}
                    </tbody>
                </table>
            `;

            container.innerHTML = tableHTML;
        }
        function generateAsdSsdQuestionnaire() {
            const container = document.getElementById("asdSsdItems");
            container.innerHTML = "";

            let tableHTML = `
                <table class="questionnaire-table">
                    <thead>
                        <tr>
                            <th>√ânonc√©</th>
                            ${[1, 2, 3, 4, 5].map(val => `<th>${val}</th>`).join('')}
                        </tr>
                    </thead>
                    <tbody>
                        ${asdSsdItems.map((question, index) => {
                            const id = `a${index + 1}`;
                            return `
                                <tr>
                                    <td><strong>${question}</strong></td>
                                    ${[1, 2, 3, 4, 5].map(val => `
                                        <td><input type="radio" name="${id}" value="${val}" required></td>
                                    `).join('')}
                                </tr>
                            `;
                        }).join('')}
                    </tbody>
                </table>
            `;

            container.innerHTML = tableHTML;
        }


        function endExperiment() {
            if (document.getElementById("questionnaireContainer").style.display === "block") return;

            generateQuestionnaire();
            document.getElementById("Btn").style.display = "none";
            document.getElementById("questionnaireContainer").style.display = "block";
            document.getElementById("questionnaireContainer").scrollIntoView({ behavior: "smooth" });
        }

        function nextStep() {
            currentStep++;

            // Masquer tous les containers
            document.querySelectorAll('.questionnaire-container').forEach(div => {
                div.style.display = 'none';
            });

            switch (currentStep) {
                case 1:
                    generatePersonalityQuestionnaire();
                    document.getElementById("personalityContainer").style.display = "block";
                    break;
                case 2:
                    generateAsdSsdQuestionnaire();
                    document.getElementById("asdSsdContainer").style.display = "block";
                    break;
                case 3:
                    document.getElementById("demographicContainer").style.display = "block";
                    break;
                case 4:
                    document.getElementById("finalMessage").style.display = "block";
                    document.getElementById("downloadBtn").style.display = "inline-block";
                    break;
            }

            window.scrollTo({ top: 0, behavior: "smooth" });
        }



        function downloadExcel() {
            let wb = XLSX.utils.book_new(); // Cr√©ation du fichier Excel

            // üîπ Feuille "Questionnaire" (dans une feuille Excel s√©par√©e)
            if (questionnaireResponses.length > 0) {
                console.log("‚úÖ R√©ponses du questionnaire :", questionnaireResponses);
                let wsQuestionnaire = XLSX.utils.json_to_sheet(questionnaireResponses);
                XLSX.utils.book_append_sheet(wb, wsQuestionnaire, "Questionnaire");
            }

            if (personalityResponses.length > 0) {
                let wsPersonality = XLSX.utils.json_to_sheet(personalityResponses);
                XLSX.utils.book_append_sheet(wb, wsPersonality, "Personnalit√©");
            }
            if (asdSsdResponses.length > 0) {
                let wsAsdSsd = XLSX.utils.json_to_sheet(asdSsdResponses);
                XLSX.utils.book_append_sheet(wb, wsAsdSsd, "ASD-SSD Continuum");
            }
            if (Object.keys(demographicResponses).length > 0) {
                let wsDemographics = XLSX.utils.json_to_sheet([demographicResponses]);
                XLSX.utils.book_append_sheet(wb, wsDemographics, "Donn√©es d√©mographiques");
            }



            // üîπ G√©n√©rer et t√©l√©charger le fichier Excel
            XLSX.writeFile(wb, "resultats_experience.xlsx");
            window.location.href = "ccalibrage.html";
        }
        document.getElementById("questionnaireForm").addEventListener("submit", function(e) {
            e.preventDefault();

            const formData = new FormData(this);
            questionnaireResponses = questionnaireItems.map((question, i) => {
                const key = `q${i + 1}`;
                return {
                    Question: question,
                    R√©ponse: formData.get(key)
                };
            });

            nextStep();
        });

        document.getElementById("personalityForm").addEventListener("submit", function(e) {
            e.preventDefault();

            const formData = new FormData(this);
            personalityResponses = personalityItems.map((question, i) => {
                const key = `p${i + 1}`;
                return {
                    Question: question,
                    R√©ponse: formData.get(key)
                };
            });

            nextStep();
        });

        document.getElementById("asdSsdForm").addEventListener("submit", function(e) {
            e.preventDefault();

            const formData = new FormData(this);
            asdSsdResponses = asdSsdItems.map((question, i) => {
                const key = `a${i + 1}`;
                return {
                    Question: question,
                    R√©ponse: formData.get(key)
                };
            });

            nextStep();
        });

        document.getElementById("demographicForm").addEventListener("submit", function(e) {
            e.preventDefault();

            const formData = new FormData(this);
            demographicResponses = {
                Age: formData.get("age"),
                Sexe: formData.get("sex"),
                "Niveau d'√©tudes": formData.get("education"),
                Dyslexie: formData.get("dyslexic")
            };

            nextStep();
        });

    </script>
</body>
</html>
