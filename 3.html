<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bo√Æte Mail - Exp√©rience de D√©tection de Phishing</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.3/xlsx.full.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #e5e7eb;
            display: flex;
            height: 100vh;
            margin: 0;
        }
        .sidebar {
            width: 300px;
            background: #ffffff;
            border-right: 300px solid #e5e7eb;
            padding: 20px;
            box-shadow: 20px 0 10px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            min-width: 300px; /* Fixe une largeur minimum */
            flex-shrink: 0; /* Emp√™che la r√©duction automatique */
        }
        .email-list {
            list-style: none;
            padding: 0;
            margin: 0;
            overflow-y: auto;
            flex-grow: 1;
        }
        .email-list li {
            padding: 12px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background 0.3s;
        }
        .email-list li:hover {
            background: #f0f0f0;
        }
        .questionnaire-instructions {
            font-size: 18px;
            font-weight: bold;
            background-color: #f9f9f9;
            border-left: 5px solid #007bff;
            padding: 15px;
            margin-bottom: 25px;
            border-radius: 6px;
        }

        .questionnaire-scale-info {
            text-align: center;
            font-size: 14px;
            font-style: italic;
            margin-bottom: 20px;
            color: #555;
        }

        .email-content-container {
            padding: 20px;
            align-items: center;
            background: #e5e7eb;
            width: 10000px;
            length: 3000px
        }
        .questionnaire-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 30px;
        }

        .questionnaire-table th,
        .questionnaire-table td {
            border: 1px solid #ccc;
            padding: 10px;
            text-align: center;
            font-size: 14px;
        }

        .questionnaire-table th {
            background-color: #f0f0f0;
            font-weight: bold;
        }

        .questionnaire-table td:first-child {
            text-align: left;
        }

        .questionnaire-instructions {
            font-size: 18px;
            font-weight: bold;
            background-color: #f9f9f9;
            border-left: 5px solid #007bff;
            padding: 15px;
            margin-bottom: 25px;
            border-radius: 6px;
        }

        .email-container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
            padding: 30px;
            width: 780px;
            height: 400px;
            margin-bottom: 40px;
        }

        .questionnaire-container {
            background: #ffffff;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            padding: 30px;
            width: 100%;
            max-width: 800px;
            text-align: left;
            margin-bottom: 20px;
            display: none;
        }

        .notation-container {
            background: #b0b3b8;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            padding: 20px;
            width: 100%;
            max-width: 800px;
            text-align: center;
            display: none;
        }
        .email-header {
            display: flex;
            align-items: center;
            margin-bottom: 50px;
        }
        .email-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: #4caf50;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 18px;
            font-weight: bold;
            margin-right: 50px;
        }
        .email-subject {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 40px;
        }
        .email-content {
            font-size: 15px;
            color: #444;
            line-height: 1.6;
            border-top: 1px solid #ddd;
            padding-top: 15px;
        }
        .email-signature {
            font-size: 15px;
            color: #444;
            font-weight: bold;
            margin-bottom: 15px;
        }
        .likert-scale {
            margin-top: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 15px;
            background: #f1f1f1;
            padding: 10px;
            border-radius: 8px;
        }
        .likert-scale label {
            cursor: pointer;
            padding: 5px;
            transition: 0.2s;
        }
        .likert-scale label:hover {
            background-color: #ddd;
            border-radius: 5px;
        }
        .submit-button {
            margin-top: 15px;
            padding: 12px;
            font-size: 16px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            width: 100%;
            font-weight: bold;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <h3>üì¨ Bo√Æte de R√©ception üì¨</h3>
        <ul class="email-list" id="emailList"></ul>
    </div>
    <div class="email-content-container">
        <div id="emailDisplay" class="email-container"> <br> <br> <br> <br> S√©lectionnez un email pour l'afficher. 
        <br> <br> <br> <br> ‚ö†Ô∏è Evaluer le risque que le mail soit une arnaque ‚ö†Ô∏è <br> <br>  Ne pas √©valuer le risque ou la possibilit√© de 
        vous faire <br> r√©ellement arnaquer (ex : vous faire soutirer de l'argent).            
        </div>
        <div id="questionnaireContainer" class="questionnaire-container">
            <form id="questionnaireForm">
                <button type="submit" class="submit-button" style="margin-bottom: 30px;">
                    Soumettre le questionnaire
                </button>
                <div id="questionnaireItems"></div>
            </form>
        </div>
        <div id="finalMessage" style="display: none; font-size: 18px; font-weight: bold; margin-bottom: 20px;">
            Exp√©rience termin√©e, merci !
        </div>
        <div id="personalityContainer" class="questionnaire-container" style="display: none;">
            <form id="personalityForm">
                <div class="questionnaire-instructions">
                    Veuillez lire attentivement chaque √©nonc√© et √©valuez √† quel point cet √©nonc√© vous d√©crit.
                    <br><br>
                    1 = Total d√©saccord &nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp; 5 = Total accord
                </div>
                <div id="personalityItems"></div>
                <div style="text-align: center;">
                    <button type="submit" class="submit-button">Soumettre le questionnaire</button>
                </div>
            </form>
        </div>
        <div id="asdSsdContainer" class="questionnaire-container" style="display: none;">
            <form id="asdSsdForm">
                <div class="questionnaire-instructions">
                    Pour chaque √©nonc√©, indiquez dans quelle mesure vous √™tes d'accord :<br><br>
                    1 = Pas du tout d‚Äôaccord &nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp; 5 = Tout √† fait d‚Äôaccord
                </div>
                <div id="asdSsdItems"></div>
                <div style="text-align: center;">
                    <button type="submit" class="submit-button">Soumettre le questionnaire</button>
                </div>
            </form>
        </div>
        <div id="demographicContainer" class="questionnaire-container" style="display: none;">
            <form id="demographicForm">
                <div class="questionnaire-instructions">
                    Merci de r√©pondre aux questions suivantes :
                </div>
                <div style="margin-bottom: 15px;">
                    <label for="num_participant"><strong>Num√©ro de participant</strong></label><br>
                    <input type="number" name="num_participant" id="num_participant" required>
                </div>
                <div style="margin-bottom: 15px;">
                    <label for="age"><strong>Quel est votre √¢ge ?</strong></label><br>
                    <input type="number" name="age" id="age" required>
                </div>

                <div style="margin-bottom: 15px;">
                    <label><strong>Quel est votre sexe ?</strong></label><br>
                    <label><input type="radio" name="sex" value="Homme" required> Homme</label>
                    <label><input type="radio" name="sex" value="Femme" required> Femme</label>
                    <label><input type="radio" name="sex" value="Autre" required> Autre</label>
                </div>

                <div style="margin-bottom: 15px;">
                    <label><strong>Niveau d'√©tudes :</strong></label><br>
                    <select name="education" required>
                        <option value="">--S√©lectionnez--</option>
                        <option value="Aucun dipl√¥me">Aucun dipl√¥me</option>
                        <option value="Coll√®ge">Coll√®ge</option>
                        <option value="Lyc√©e">Lyc√©e</option>
                        <option value="Bac">Bac</option>
                        <option value="Bac+2">Bac+2</option>
                        <option value="Bac+3">Bac+3</option>
                        <option value="Bac+5 ou plus">Bac+5 ou plus</option>
                    </select>
                </div>

                <div style="margin-bottom: 15px;">
                    <label><strong>√ätes-vous dyslexique ?</strong></label><br>
                    <label><input type="radio" name="dyslexic" value="Oui" required> Oui</label>
                    <label><input type="radio" name="dyslexic" value="Non" required> Non</label>
                    <label><input type="radio" name="dyslexic" value="Je ne sais pas"> Je ne sais pas</label>
                </div>

                <div style="text-align: center;">
                    <button type="submit" class="submit-button">Soumettre</button>
                </div>
            </form>
        </div>

        <button id="downloadBtn" class="submit-button" onclick="downloadExcel()" style="display: none;">
            T√©l√©charger les r√©sultats
        </button>
        <div class="notation-container" id="notationContainer">
            <p>Evaluation du risque :</p>
            <div class="likert-scale" id="likertScale"></div>
            <button class="submit-button" onclick="recordResponse()">Soumettre</button>
        </div>
        <div class="notation-container" id="confidenceContainer" style="display: none;">
            <p>√Ä quel point √™tes-vous s√ªr(e) de votre √©valuation pr√©c√©dente ?</p>
            <div class="likert-scale" id="confidenceScale"></div>
            <button class="submit-button" onclick="submitConfidence()">Valider la confiance</button>
        </div>

    </div>
    <script>
        let emails = [
            {
                sender: "no-reply@impots.gouv.fr",
                name: "Direction G√©n√©rale des Finances Publiques",
                subject: "Rappel concernant votre avis d‚Äôimposition",
                content: "Bonjour,<br><br>Votre avis d‚Äôimposition est d√©sormais disponible dans votre espace particulier. Aucune action n‚Äôest requise si vous √™tes √† jour dans vos paiements.<br><br><br><br>Cordialement,<br>",
                signature: "Service des Imp√¥ts",
                isPhishing: false
            }, //00
            {
                sender: "notif@banquepaiement-gratuit.click",
                name: "Service Banquaire",
                subject: "Probl√©me sur votre conpte",
                content: "Bonjours,<br><br>Nous avon remarqu√© un tranzaction susspicieuse. Veiller verifier les doner de votre profile au plus vite.<br><br><br><br>Merci,<br>",
                signature: "Aide bancaire",
                isPhishing: true
            },//22

            {
                sender: "securite@banque-france.fr",
                name: "Alerte Bancaire",
                subject: "Rretir argent sur votre conte",
                content: "Bonjours,<br><br>Une rtrait suspicieus a ete detecter sur votre conte. Veuiller verifiais vos operations au plus vitre pour eviter tout bloquage.<br><br><br><br>Merci pour votre comprhension,<br>",
                signature: "Le sercice client",
                isPhishing: true
            }, //2 ortho

            {
                sender: "france.impots.verif@alertes-fiscales.ru",
                name: "Direction G√©n√©rale des Finances Publiques",
                subject: "Erreur de d√©claration √† corriger",
                content: "Cher contribuable,<br><br>Une erreur a √©t√© d√©tect√©e dans votre derni√®re d√©claration. Merci de v√©rifier votre situation au plus vite afin d'√©viter des p√©nalit√©s.<br><br><br><br>Respectueusement,<br>",
                signature: "Imp√¥ts France",
                isPhishing: true
            }, //2 cr√©dit
            {
                sender: "noreply@orange-fr.net",
                name: "Orange Assistance",
                subject: "Mise √† jour de vos informations requise",
                content: "Bonjour,<br><br>Nous vous invitons √† v√©rifier vos informations personnelles dans votre espace client afin de garantir la s√©curit√© de vos services.<br><br><br><br>Cordialement,<br>",
                signature: "Service Client Orange",
                isPhishing: true
            }, //1 cr√©dit
            {
                sender: "info@ameli-france.info",
                name: "Ameli",
                subject: "Mise √† jour de votre dossier sant√©",
                content: "Cher assur√©,<br><br>Une v√©rification de vos informations est en cours. Veuillez vous connecter a votre espace pour eviter toute interruption de vos droits.<br><br><br><br>Respectueusement,<br>",
                signature: "L'√©quipe Ameli",
                isPhishing: true
            },//11


            {
                sender: "noreply@impots.gouv.fr",
                name: "Administraion Fiscal",
                subject: "Probleme sur votr dossier",
                content: "Bonjor,<br><br>Nous avon detect√© une erreure dans vos derniere declarartions. Merci de prandre contact avec nos service dans les plus bref delais.<br><br><br><br>Bien courdialement,<br>",
                signature: "Direction des impots",
                isPhishing: true
            }, //2 ortho


            {
                sender: "noreply@ameli.fr",
                name: "Assurance Maladie",
                subject: "V√©rification de votre dossier",
                content: "Cher assur√©,<br><br>Une anomalie ont √©t√© d√©tect√©e dans votre dossier. Merci de v√©rifier vos informations afin d'√©viter une suspension de vos droits.<br><br><br><br>Cordialement,<br>",
                signature: "Service Ameli",
                isPhishing: true
            }, //1 faute subtile

            {
                sender: "service-client@francetelecom.fr",
                name: "Service T√©l√©communication",
                subject: "Mise ajour obligatoire",
                content: "Cher utilisater,<br><br>Nous vos informon que une mise ajour importante doive √™tre fais sur votre compte. Sans celas, vos service serront suspendue.<br><br><br><br>Sinc√®rement,<br>",
                signature: "L'equipe tehnique",
                isPhishing: true
            }, //2 ortho


            {
                sender: "alerte@laposte.fr",
                name: "La Poste",
                subject: "Colis en attente de confirmation",
                content: "Bonjour,<br><br>Un colis est en attente de confirmation d'adresse. Sans action de votre part, il sera retourn√© au plus tard sous 48 heures. Merci de verifier vos informations.<br><br><br><br>Cordialement,<br>",
                signature: "Service Courrier",
                isPhishing: true
            },//1 fautes subtiles


            {
                sender: "securite-compte@banque-promo.win",
                name: "Service S√©curit√© Banque",
                subject: "Suspension temporaire de votre compte",
                content: "Bonjour,<br><br>Votre compte bancaire a √©t√© temporairement suspendu pour des raisons de s√©curit√©. Merci de vous connecter √† votre espace personnel pour valider votre identit√©.<br><br><br><br>Cordialement,<br>",
                signature: "Service Client Banque",
                isPhishing: true
            }, // 2 cr√©dit
            {
                sender: "facture@edf-contact.info",
                name: "Service EDF",
                subject: "Facture en atente de reglement",
                content: "Cher client,<br><br>Votre derniere facture na pas ete r√©gler. Merci de proced√© au reglement au plus vitre pour evit√© la coupure.<br><br><br><br>Respetueusement,<br>",
                signature: "Service Client EDF",
                isPhishing: true
            },//21 cr√©dit

            {
                sender: "assistance@edf.fr",
                name: "EDF Assistance",
                subject: "Paiement non r√©ceptionn√©",
                content: "Bonjour,<br><br>Votre dernier paiement n'a pas encore √©t√© r√©ceptionn√©. Merci de r√©gulariser votre situation dans les plus bref d√©lais pour eviter toute interruption.<br><br><br><br>Respectueusement,<br>",
                signature: "Service Client EDF",
                isPhishing: true
            },//1 faute


            {
                sender: "amazonclientzone2024@gestion-alertes.site",
                name: "Service Amazon",
                subject: "Activit√© inhabituelle d√©tect√©e",
                content: "Bonjour,<br><br>Une tentative de connexion inhabituelle a √©t√© d√©tect√©e sur votre compte Amazon. Merci de v√©rifier vos informations pour s√©curiser votre acc√®s.<br><br><br><br>Merci,<br>",
                signature: "Amazon S√©curit√©",
                isPhishing: true
            }, // 2 cr√©dibilit√©

            {
                sender: "service-client@ameli-france.info",
                name: "Assurance Maladie",
                subject: "Notification importante",
                content: "Cher assur√©,<br><br>Une v√©rification de vos droits est en cours. Merci de consulter votre espace personnel pour finaliser le processus.<br><br><br><br>Respectueusement,<br>",
                signature: "L'√©quipe Ameli",
                isPhishing: true
            }, //1 cr√©dit
            {
                sender: "contact@ameli.fr",
                name: "Assurance Maladie",
                subject: "Mise √† jour de vos remboursements",
                content: "Cher assur√©,<br><br>Vos remboursements de soins r√©cents ont √©t√© trait√©s. Vous pouvez consulter le d√©tail des op√©rations dans votre compte personnel sur le site Ameli.<br><br><br><br>Bien √† vous,<br>",
                signature: "L‚Äô√©quipe Ameli",
                isPhishing: false
            }, //00

            {
                sender: "support@connexion.orange-securite.biz",
                name: "Orange Support",
                subject: "Tentative de connexion d√©tect√©e",
                content: "Cher client,<br><br>Une tentative de connection a √©t√© detect√©e depuis un nouvel appareil. Merci de confirmer que cette activit√© viens bien de vous.<br><br><br><br>Merci de votre r√©activit√©,<br>",
                signature: "Service Orange",
                isPhishing: true
            },//12cr√©dit
            {
                sender: "notif-client@poste-livraison.fr",
                name: "La Poste",
                subject: "Probl√®me de livraizon colis",
                content: "Bonjours,<br><br>Un coli n'a pas pue etre livrer √† votre adresse. Veiller a corriger vos doner pour evit√©e le retour.<br><br><br><br>Merci de votre comprhension,<br>",
                signature: "Service Livraizon",
                isPhishing: true
            },//21cr√©dit
            {
                sender: "securite@orange-support.net",
                name: "Orange S√©curit√©",
                subject: "Suspension temporaire de votre compte",
                content: "Bonjour,<br><br>Votre compte √† fait l'objet d'une tentative de connexion inhabituelle. Merci de confirmer votre identit√© dans les plus bref d√©lais afin d'assurer la continuit√© du service.<br><br><br><br>Cordialement,<br>",
                signature: "Support Orange",
                isPhishing: true
            },//11
            {
                sender: "client-alert@securite-banque2024.win",
                name: "S√©curit√© Banque",
                subject: "Validation d'activit√© n√©cessaire",
                content: "Bonjour,<br><br>Une activit√©e inhabituelle √† √©t√© relev√©e sur votre compte. Merci de verifier vos informations d√®s que possible pour √©viter une d√©sactivation.<br><br><br><br>Cordialement,<br>",
                signature: "Support S√©curit√©",
                isPhishing: true
            },//12cr√©dit

            {
                sender: "messagerie@impots-gouv.com",
                name: "Direction G√©n√©rale des Finances Publiques",
                subject: "Votre dossier fiscal n√©cessite une attention",
                content: "Bonjour,<br><br>Nous avons besoin de valider certaines informations concernant votre situation fiscale. Merci d'acc√©der √† votre espace personnel pour r√©gulariser votre dossier.<br><br><br><br>Bien √† vous,<br>",
                signature: "Service des Imp√¥ts",
                isPhishing: true
            }, //1 cr√©dibilit√©


            {
                sender: "suivi-colis@laposte.fr",
                name: "La Poste",
                subject: "Votre colis a bien √©t√© livr√©",
                content: "Bonjour,<br><br>Nous vous confirmons que votre colis a bien √©t√© livr√© √† l‚Äôadresse indiqu√©e. Si vous n‚Äôavez pas r√©ceptionn√© ce colis, veuillez contacter votre bureau de poste habituel.<br><br><br><br>Cordialement,<br>",
                signature: "Service Client La Poste",
                isPhishing: false
            },// 00
            {
                sender: "urgence-secu@dropbox-alert.info",
                name: "Dropbox Alerte",
                subject: "Fichier bloque√© pour securit√©e",
                content: "Cher utilisater,<br><br>Un fichi√© que vous avez recu √† √©t√© bloquer pour raison de securit√©. Merci de confirmer vos identifiant pour continuer.<br><br><br><br>Support Dropboks,<br>",
                signature: "Securit√©e Cloud",
                isPhishing: true
            },//22

            {
                sender: "contact@service-impots.com",
                name: "Direction G√©n√©rale des Finances Publiques",
                subject: "Notification de remboursement",
                content: "Bonjour,<br><br>Un remboursement √† √©t√© valid√© sur votre dossier fiscal. Merci de verifier vos informations bancaires afin que le virement soit effectu√© sans delais.<br><br><br><br>Cordialement,<br>",
                signature: "Service des Imp√¥ts",
                isPhishing: true
            },//11


            {
                sender: "alerte@france-tele-info.net",
                name: "Support France Telecom",
                subject: "Activit√© suspecte sur votre compte",
                content: "Bonjour,<br><br>Nous avon remarqu√© une acitivit√© suspecte sur votre profile. Veuillez verifi√© vos information pour √©viter tous probleme.<br><br><br><br>Sinc√®rement,<br>",
                signature: "Assistance Technique",
                isPhishing: true
            },//21cr√©dit

            {
                sender: "infos@remboursement-impots-now.cc",
                name: "Imp√¥ts France",
                subject: "Montant √† r√©cup√©rer",
                content: "Bonjour,<br><br>Un montant √† √©t√© calcul√© pour remboursement. Merci de valider vos informations afin de ne pas perdre votre droit.<br><br><br><br>Respectueusement,<br>",
                signature: "Direction fiscale",
                isPhishing: true
            },//12cr√©dit

            {
                sender: "virement-auto@paypal-remboursement.xyz",
                name: "Service Client Paypal",
                subject: "Remboursemant en cours",
                content: "Bonjours,<br><br>Un rembourssement √† √©t√© enclanch√© sur votre compte. Verifier les infomation fournie pour valid√© la tranzaction.<br><br><br><br>Merci pour votre confiance,<br>",
                signature: "Equipe Paypal",
                isPhishing: true
            },//22
        ];

        const questionnaireItems = [
            "1. Avouer que vos go√ªts sont diff√©rents de ceux d‚Äôun ami.",
            "2. Aller camper en pleine nature.",
            "3. Parier une journ√©e de salaire aux courses de chevaux.",
            "4. Investir 10% de vos revenus annuels dans un fonds mutuel √† croissance mod√©r√©e.",
            "5. Boire abondamment lors d‚Äôune activit√© sociale.",
            "6. Tricher par un montant important dans votre d√©claration d‚Äôimp√¥t.",
            "7. √ätre en d√©saccord avec un symbole d‚Äôautorit√© sur une question importante.",
            "8. Parier une journ√©e de salaire lors d‚Äôune partie de poker √† enjeu important.",
            "9. Avoir une aventure avec un homme ou une femme mari√©(e).",
            "10. Pr√©senter le travail de quelqu‚Äôun d‚Äôautre comme √©tant le v√¥tre.",
            "11. Descendre une pente de ski exigeant une habilet√© plus grande que la v√¥tre.",
            "12. Investir 5% de vos revenus annuels dans des titres tr√®s sp√©culatifs.",
            "13. Faire de la descente en eau vive au printemps, quand le niveau de l‚Äôeau est √©lev√©.",
            "14. Parier une journ√©e de salaire sur le r√©sultat d‚Äôun √©v√©nement sportif.",
            "15. Avoir des relations sexuelles sans protection.",
            "16. R√©v√©ler le secret d‚Äôun ami √† un autre ami.",
            "17. Conduire une voiture sans porter de ceinture de s√©curit√©.",
            "18. Investir 10% de vos revenus annuels dans une nouvelle entreprise.",
            "19. Suivre un cours de parachutisme.",
            "20. Conduire une motocyclette sans casque protecteur.",
            "21. Choisir une carri√®re qui vous pla√Æt vraiment plut√¥t qu‚Äôune carri√®re s√©curitaire.",
            "22. Dire votre opinion sur une question controvers√©e lors d‚Äôune r√©union au travail.",
            "23. Vous faire bronzer sans √©cran solaire.",
            "24. Effectuer un saut √† l‚Äô√©lastique √† partir d‚Äôun pont √©lev√©.",
            "25. Piloter un petit avion.",
            "26. Rentrer chez vous √† pied le soir dans un quartier peu s√©curitaire.",
            "27. D√©m√©nager dans une ville √©loign√©e de votre famille.",
            "28. Entreprendre une nouvelle carri√®re au cours de la mi-trentaine.",
            "29. Laisser vos enfants seuls √† la maison pendant que vous faites une course.",
            "30. Ne pas retourner un portefeuille trouv√© contenant 200$."
        ];

        let questionnaireResponses = [];

        const personalityItems = [
            "1. Je suis le bout en train dans les partys.",
            "2. Je sympathise avec les sentiments des autres.",
            "3. J‚Äôaccomplis les t√¢ches m√©nag√®res sans d√©lai.",
            "4. J‚Äôai de fr√©quentes sautes d‚Äôhumeur.",
            "5. J‚Äôai une imagination fertile.",
            "6. Je ne parle pas beaucoup.",
            "7. Les probl√®mes des autres ne m'int√©ressent pas.",
            "8. J‚Äôoublie souvent de ranger les choses l√† o√π elles vont.",
            "9. Je suis d√©tendu la plupart du temps.",
            "10. Je n'ai pas d'int√©r√™t pour les id√©es abstraites.",
            "11. Je parle √† plusieurs personnes diff√©rentes dans les partys.",
            "12. Je ressens les √©motions des autres.",
            "13. J‚Äôaime l‚Äôordre.",
            "14. Je suis facilement contrari√©.",
            "15. J‚Äôai de la difficult√© √† comprendre les id√©es abstraites.",
            "16. J‚Äôai tendance √† rester en retrait.",
            "17. Je ne suis pas vraiment int√©ress√© par les autres.",
            "18. Je suis d√©sordonn√©.",
            "19. Je me sens rarement d√©prim√©.",
            "20. J‚Äôai tr√®s peu d‚Äôimagination."
        ];

        let personalityResponses = [];

        const asdSsdItems = [
            "1. Je pr√©f√®re m'appuyer sur les faits et les observations plut√¥t que sur mon intuition.",
            "2. Il m‚Äôarrive de penser que certains √©v√©nements ont une signification cach√©e.",
            "3. Je ressens peu d‚Äôint√©r√™t pour les interactions sociales.",
            "4. J‚Äôai tendance √† faire confiance √† mon instinct, m√™me sans preuve.",
            "5. Je remarque rapidement les petits d√©tails que les autres ne voient pas.",
            "6. Il m‚Äôarrive de croire que certaines co√Øncidences ne sont pas dues au hasard.",
            "7. Je suis mal √† l‚Äôaise dans les situations sociales.",
            "8. Je pense que mes croyances peuvent influencer la r√©alit√©.",
            "9. J‚Äôaime que les choses soient bien rang√©es et organis√©es.",
            "10. Il m‚Äôarrive d‚Äôavoir des pens√©es ou des perceptions √©tranges que je n‚Äôarrive pas √† expliquer."
        ];

        let asdSsdResponses = [];

        let demographicResponses = {};

        let results = [];
        let startTime;
        let confidenceLevel = null;
        let evaluationInProgress = false;

        let currentEmailIndex = null;
   

        // Fonction pour r√©cup√©rer les coordonn√©es d'un √©l√©ment HTML
        function getElementBounds(selector) {
            const element = document.querySelector(selector);
            if (element) {
                const rect = element.getBoundingClientRect();
                return {
                    top: rect.top,
                    bottom: rect.bottom,
                    left: rect.left,
                    right: rect.right
                };
            }
            return null;
        }

       

        function loadEmailList() {
            const emailList = document.getElementById("emailList");
            emailList.innerHTML = emails.map((email, index) => `
                <li onclick="displayEmail(${index})"> <strong>${email.name}</strong><br><small>${email.subject}</small></li>
            `).join('');

            if (emails.length === 0) {
                document.getElementById("downloadBtn").classList.remove("hidden");
                document.getElementById("emailDisplay").innerHTML = "Tous les emails ont √©t√© not√©s.";
                document.getElementById("notationContainer").style.display = "none";
            }
        }


        function getInitials(name) {
            return name.split(" ").map(word => word[0]).join("").toUpperCase();
        }
       
        function displayEmail(index) {
            if (evaluationInProgress) {
                alert("Veuillez terminer l‚Äô√©valuation et valider votre niveau de confiance avant de consulter un autre mail.");
                return;
            }
            startTime = Date.now(); // D√É¬©marrer le chronom√É¬®tre
            currentEmailIndex = index;
            const email = emails[index];
            document.getElementById("emailDisplay").innerHTML = `
                <div class="email-header">
                    <div class="email-avatar">${getInitials(email.name)}</div>
                    <div>
                        <strong>${email.name}</strong> <br>
                        <span style="color: gray;">${email.sender}</span>
                    </div>
                </div>
                <div class="email-subject">${email.subject}</div>
                <div class="email-content">${email.content}</div>
                <div class="email-signature">${email.signature}</div>
            `;
            document.getElementById("notationContainer").style.display = "block";
            generateLikertScale();
            setTimeout(defineZones, 500); // Attendre le rendu de l'email avant d'analyser
            evaluationInProgress = true;
        }

        function generateLikertScale() {
            document.getElementById("likertScale").innerHTML = `
                <span>1 (Pas suspect)</span>
                ${[1, 2, 3, 4, 5, 6, 7].map(num => `<label><input type="radio" name="likert" value="${num}"> ${num}</label>`).join('')}
                <span>7 (Tr√®s suspect)</span>
            `;
        }

        function recordResponse() {
            const selectedValue = document.querySelector('input[name="likert"]:checked');
            if (!selectedValue) {
                alert("Veuillez s√©lectionner une valeur sur l'√©chelle.");
                return;
            }

            // Masquer l‚Äô√©chelle d‚Äô√©valuation, afficher l‚Äô√©chelle de confiance
            document.getElementById("notationContainer").style.display = "none";
            document.getElementById("confidenceContainer").style.display = "block";
            generateConfidenceScale();
        }


        function generateQuestionnaire() {
            const container = document.getElementById("questionnaireItems");
            container.innerHTML = "";

            const instructions = `
                <div class="questionnaire-instructions">
                    Merci de r√©pondre au questionnaire suivant. Pour chaque √©nonc√©, indiquez √† quel point vous seriez susceptible d‚Äôagir ainsi :
                    <br><br>1 = Extr√™mement peu probable &nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp; 7 = Extr√™mement probable
                </div>
            `;
            container.insertAdjacentHTML("beforebegin", instructions);

            let tableHTML = `
                <table class="questionnaire-table">
                    <thead>
                        <tr>
                            <th>Question</th>
                            ${[1, 2, 3, 4, 5, 6, 7].map(val => `<th>${val}</th>`).join('')}
                        </tr>
                    </thead>
                    <tbody>
                        ${questionnaireItems.map((question, index) => {
                            const id = `q${index + 1}`;
                            return `
                                <tr>
                                    <td><strong>${question}</strong></td>
                                    ${[1, 2, 3, 4, 5, 6, 7].map(val => `
                                        <td>
                                            <input type="radio" name="${id}" value="${val}" required>
                                        </td>
                                    `).join('')}
                                </tr>
                            `;
                        }).join('')}
                    </tbody>
                </table>
                <div style="text-align: center;">
                    <button type="submit" class="submit-button">
                        Soumettre le questionnaire
                    </button>
                </div>
            `;

            container.innerHTML = tableHTML;
        }
        function generateConfidenceScale() {
            document.getElementById("confidenceScale").innerHTML = `
                <span>1 (Pas s√ªr du tout)</span>
                ${[1, 2, 3, 4, 5, 6, 7].map(num => `
                    <label><input type="radio" name="confidence" value="${num}"> ${num}</label>
                `).join('')}
                <span>7 (Tout √† fait s√ªr)</span>
            `;
        }
        function submitConfidence() {
            const evalValue = document.querySelector('input[name="likert"]:checked');
            const confValue = document.querySelector('input[name="confidence"]:checked');

            if (!evalValue) {
                alert("Vous devez √©valuer le risque avant de valider la confiance.");
                return;
            }

            if (!confValue) {
                alert("Veuillez indiquer votre niveau de confiance.");
                return;
            }

            let reactionTime = Date.now() - startTime;

            results.push({
                email: emails[currentEmailIndex].sender,
                "Temps de R√©action (ms)": reactionTime,
                "√âvaluation du risque (1-7)": evalValue.value,
                Confidence: confValue.value,
            });

            // Nettoyage et passage √† la suite
            document.getElementById("confidenceContainer").style.display = "none";
            evaluationInProgress = false;
            emails.splice(currentEmailIndex, 1);
            currentEmailIndex = null;
            loadEmailList();

            if (emails.length > 0) {
                document.getElementById("emailDisplay").innerHTML = "S√©lectionnez un email pour l'afficher.";
            } else {
                endExperiment(); // üéØ Affiche DOSPERT
            }
        }




        function generatePersonalityQuestionnaire() {
            const container = document.getElementById("personalityItems");
            container.innerHTML = "";

            let tableHTML = `
                <table class="questionnaire-table">
                    <thead>
                        <tr>
                            <th>√ânonc√©</th>
                            ${[1, 2, 3, 4, 5].map(val => `<th>${val}</th>`).join('')}
                        </tr>
                    </thead>
                    <tbody>
                        ${personalityItems.map((question, index) => {
                            const id = `p${index + 1}`;
                            return `
                                <tr>
                                    <td><strong>${question}</strong></td>
                                    ${[1, 2, 3, 4, 5].map(val => `
                                        <td><input type="radio" name="${id}" value="${val}" required></td>
                                    `).join('')}
                                </tr>
                            `;
                        }).join('')}
                    </tbody>
                </table>
            `;

            container.innerHTML = tableHTML;
        }
        function generateAsdSsdQuestionnaire() {
            const container = document.getElementById("asdSsdItems");
            container.innerHTML = "";

            let tableHTML = `
                <table class="questionnaire-table">
                    <thead>
                        <tr>
                            <th>√ânonc√©</th>
                            ${[1, 2, 3, 4, 5].map(val => `<th>${val}</th>`).join('')}
                        </tr>
                    </thead>
                    <tbody>
                        ${asdSsdItems.map((question, index) => {
                            const id = `a${index + 1}`;
                            return `
                                <tr>
                                    <td><strong>${question}</strong></td>
                                    ${[1, 2, 3, 4, 5].map(val => `
                                        <td><input type="radio" name="${id}" value="${val}" required></td>
                                    `).join('')}
                                </tr>
                            `;
                        }).join('')}
                    </tbody>
                </table>
            `;

            container.innerHTML = tableHTML;
        }


        function endExperiment() {
            document.getElementById("notationContainer").style.display = "none";
            document.getElementById("emailDisplay").style.display = "none";
            document.getElementById("emailList").style.display = "none";

            setTimeout(() => {
                generateQuestionnaire();
                document.getElementById("questionnaireContainer").style.display = "block";
                document.getElementById("questionnaireContainer").scrollIntoView({ behavior: "smooth" });
            }, 300);
        }



        function downloadExcel() {
            let wb = XLSX.utils.book_new(); // Cr√©ation du fichier Excel

            // üîπ Premi√®re feuille : R√©sum√© des emails avec temps de r√©action et √©valuation
            let summaryData = results.map(result => ({
                "Email": result.email,
                "Temps de R√©action (ms)": result["Temps de R√©action (ms)"],
                "√âvaluation du Risque (1-7)": result["√âvaluation du risque (1-7)"],
                "Confiance (1-7)": result.Confidence
            }));

            let wsSummary = XLSX.utils.json_to_sheet(summaryData);
            XLSX.utils.book_append_sheet(wb, wsSummary, "R√©sum√© G√©n√©ral");


            // üîπ Feuille "Questionnaire" (dans une feuille Excel s√©par√©e)
            if (questionnaireResponses.length > 0) {
                console.log("‚úÖ R√©ponses du questionnaire :", questionnaireResponses);
                let wsQuestionnaire = XLSX.utils.json_to_sheet(questionnaireResponses);
                XLSX.utils.book_append_sheet(wb, wsQuestionnaire, "Questionnaire");
            }

            if (personalityResponses.length > 0) {
                let wsPersonality = XLSX.utils.json_to_sheet(personalityResponses);
                XLSX.utils.book_append_sheet(wb, wsPersonality, "Personnalit√©");
            }
            if (asdSsdResponses.length > 0) {
                let wsAsdSsd = XLSX.utils.json_to_sheet(asdSsdResponses);
                XLSX.utils.book_append_sheet(wb, wsAsdSsd, "ASD-SSD Continuum");
            }
            if (Object.keys(demographicResponses).length > 0) {
                let wsDemographics = XLSX.utils.json_to_sheet([demographicResponses]);
                XLSX.utils.book_append_sheet(wb, wsDemographics, "Donn√©es d√©mographiques");
            }



            // üîπ G√©n√©rer et t√©l√©charger le fichier Excel
            XLSX.writeFile(wb, "resultats_experience.xlsx");
            window.location.href = "ccalibrage.html";
        }

        loadEmailList();
        document.getElementById("questionnaireForm").addEventListener("submit", function(e) {
            e.preventDefault();

            const formData = new FormData(this);
            questionnaireResponses = questionnaireItems.map((question, i) => {
                const key = `q${i + 1}`;
                return {
                    Question: question,
                    R√©ponse: formData.get(key)
                };
            });

            console.log("R√©ponses questionnaire :", questionnaireResponses); // Optionnel

            document.getElementById("questionnaireContainer").style.display = "none";
            generatePersonalityQuestionnaire();
            document.getElementById("personalityContainer").style.display = "block";

        });

        document.getElementById("personalityForm").addEventListener("submit", function(e) {
            e.preventDefault();

            const formData = new FormData(this);
            personalityResponses = personalityItems.map((question, i) => {
                const key = `p${i + 1}`;
                return {
                    Question: question,
                    R√©ponse: formData.get(key)
                };
            });
            document.getElementById("personalityContainer").style.display = "none";
            generateAsdSsdQuestionnaire();
            document.getElementById("asdSsdContainer").style.display = "block";

        });
        document.getElementById("asdSsdForm").addEventListener("submit", function(e) {
            e.preventDefault();

            const formData = new FormData(this);
            asdSsdResponses = asdSsdItems.map((question, i) => {
                const key = `a${i + 1}`;
                return {
                    Question: question,
                    R√©ponse: formData.get(key)
                };
            });


            document.getElementById("asdSsdContainer").style.display = "none";
            document.getElementById("demographicContainer").style.display = "block";
        });
        document.getElementById("demographicForm").addEventListener("submit", function(e) {
            e.preventDefault();

            const formData = new FormData(this);
            demographicResponses = {
                Age: formData.get("age"),
                Sexe: formData.get("sex"),
                "Niveau d'√©tudes": formData.get("education"),
                Dyslexie: formData.get("dyslexic"),
                Num_participant: formData.get("num_participant"),
            };

            document.getElementById("demographicContainer").style.display = "none";
            document.getElementById("finalMessage").style.display = "block";
            document.getElementById("downloadBtn").style.display = "inline-block";
            document.getElementById("downloadBtn").disabled = false;
        });


    </script>
</body>
</html>
