<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bo√Æte Mail - Exp√©rience de D√©tection de Phishing</title>
    <script src="https://cdn.jsdelivr.net/npm/webgazer/dist/webgazer.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.3/xlsx.full.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #e5e7eb;
            display: flex;
            height: 100vh;
            margin: 0;
        }
        .sidebar {
            width: 300px;
            background: #ffffff;
            border-right: 1px solid #ccc;
            padding: 20px;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            margin-top: 40vh; /* D√©cale encore plus la sidebar vers le bas */
        }
        .email-list {
            list-style: none;
            padding: 0;
            margin: 0;
            overflow-y: auto;
            flex-grow: 1;
        }
        .email-list li {
            padding: 12px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background 0.3s;
        }
        .email-list li:hover {
            background: #f0f0f0;
        }
        .email-content-container {
            background: white;
            flex-grow: 1;
            padding: 20px;
            background: #f5f5f5;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        .email-container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
            padding: 20px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }
        .email-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        .email-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: #4caf50;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 18px;
            font-weight: bold;
            margin-right: 12px;
        }
        .email-subject {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 15px;
        }
        .email-content {
            font-size: 15px;
            color: #444;
            line-height: 1.6;
            border-top: 1px solid #ddd;
            padding-top: 15px;
        }
        .likert-scale {
            margin-top: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 15px;
            background: #f1f1f1;
            padding: 10px;
            border-radius: 8px;
        }
        .likert-scale label {
            cursor: pointer;
            padding: 5px;
            transition: 0.2s;
        }
        .likert-scale label:hover {
            background-color: #ddd;
            border-radius: 5px;
        }
        .submit-button {
            margin-top: 15px;
            padding: 12px;
            font-size: 16px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            width: 100%;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <h3>üìß Bo√Æte de R√©ception</h3>
        <ul class="email-list" id="emailList"></ul>
    </div>
    <div class="email-content-container">
        <div id="emailDisplay" class="email-container">S√©lectionnez un email pour l'afficher.</div>
        <button id="downloadBtn" class="submit-button" style="display: none;" onclick="downloadExcel()">T√©l√©charger les r√©sultats</button>
    </div>
    <script>
        let emails = [
            {
                sender: "support@google.fr",
                name: "Google Support",
                subject: "V√©rification de s√©curit√©",
                content: "Bonjour,<br><br>Nous avons d√©tect√© une connexion suspecte sur votre compte. Veuillez v√©rifier votre identit√© en cliquant sur le lien ci-dessous.<br><br><a href='#'>V√©rifier maintenant</a><br><br>Cordialement,<br>L'√©quipe Google",
                isPhishing: false
            },
            {
                sender: "admin@banquefausse.com",
                name: "Banque S√©curit√©",
                subject: "Probl√®me de s√©curit√©",
                content: "Cher client,<br><br>Nous avons remarqu√© une activit√© inhabituelle sur votre compte bancaire. Merci de mettre √† jour vos informations imm√©diatement.<br><br><a href='#'>Mettre √† jour</a><br><br>Service S√©curit√©",
                isPhishing: true
            },
            {
                sender: "support@airfrance.fr",
                name: "Support Air France",
                subject: "D√©tails de votre vol",
                content: "Cher passager,<br><br>Voici les d√©tails de votre vol r√©serv√©. Bon voyage !<br><br>Service Clients",
                isPhishing: false
            },
            {
                sender: "impots@gouv-faux.fr",
                name: "Administration fiscale",
                subject: "Fraude d√©tect√©e sur votre dossier fiscal",
                content: "Cher contribuable,<br><br>Votre dossier fiscal est sous investigation. Prenez des mesures <a href='http://fraude-fiscale-faux.com'>ici</a>.<br><br>Service Fiscalit√©",
                isPhishing: true
            },
            {
                sender: "newsletter@magazine.com",
                name: "Magazine Newsletter",
                subject: "Votre newsletter du mois",
                content: "Cher abonn√©,<br><br>D√©couvrez les derni√®res actualit√©s dans notre newsletter mensuelle.<br><br>Service Abonn√©s",
                isPhishing: false
            },
            {
                sender: "impots@gouv-faux.com",
                name: "Administration fiscale",
                subject: "Remboursement d'imp√¥ts disponible",
                content: "Cher contribuable,<br><br>Vous avez droit √† un remboursement. Cliquez <a href='http://remboursement-faux.com'>ici</a> pour le r√©clamer.<br><br>Service Fiscalit√©",
                isPhishing: true
            },
            {
                sender: "administration@universite.fr",
                name: "Universit√©",
                subject: "Confirmation d'inscription",
                content: "Cher √©tudiant,<br><br>Votre inscription pour le semestre est confirm√©e. Bonne continuation.<br><br>Service Inscriptions",
                isPhishing: false
            },
            {
                sender: "urgent@fauxmail.com",
                name: "Service Urgent",
                subject: "URGENT : V√©rifiez votre compte",
                content: "Cher utilisateur,<br><br>Votre compte sera suspendu sous 24h. Cliquez <a href='http://urgencefaux.com'>ici</a> pour √©viter cela.<br><br>Service Urgent",
                isPhishing: true
            },
            {
                sender: "RH@entreprise.com",
                name: "Ressources Humaines",
                subject: "R√©union d'√©quipe programm√©e",
                content: "Bonjour,<br><br>Une r√©union est pr√©vue vendredi √† 10h. Merci de confirmer votre pr√©sence.<br><br>Service RH",
                isPhishing: false
            },
            {
                sender: "support@dropbox-faux.com",
                name: "Support Dropbox",
                subject: "Partage de fichier en attente",
                content: "Cher utilisateur,<br><br>Un fichier important vous a √©t√© partag√©. Acc√©dez-y <a href='http://dropbox-faux.com'>ici</a>.<br><br>Service Support",
                isPhishing: true
            },
            {
                sender: "info@bibliotheque.fr",
                name: "Biblioth√®que",
                subject: "Rappel de retour de livres",
                content: "Cher lecteur,<br><br>N'oubliez pas de retourner vos livres avant la date limite.<br><br>Service Biblioth√®que",
                isPhishing: false
            },
            {
                sender: "serviceclient@fauxbanque.com",
                name: "Service Client Banque",
                subject: "Action requise pour votre compte",
                content: "Cher client,<br><br>Nous avons besoin de v√©rifier vos informations bancaires. Cliquez <a href='http://verifbanque-faux.com'>ici</a> pour les mettre √† jour.<br><br>Service Client",
                isPhishing: true
            },
            {
                sender: "contact@societe.fr",
                name: "Soci√©t√©",
                subject: "Facture de votre dernier achat",
                content: "Cher client,<br><br>Veuillez trouver ci-joint votre facture.<br><br>Service Comptabilit√©",
                isPhishing: false
            },
            {
                sender: "support@netflix-promo.com",
                name: "Support Netflix",
                subject: "Offre sp√©ciale Netflix",
                content: "Cher abonn√©,<br><br>Profitez d'un abonnement gratuit en cliquant <a href='http://netflix-faux.com'>ici</a>.<br><br>Service Support",
                isPhishing: true
            },
            {
                sender: "info@cinema.fr",
                name: "Cin√©ma",
                subject: "Confirmation de votre r√©servation",
                content: "Cher client,<br><br>Votre place de cin√©ma est confirm√©e. Bon film !<br><br>Service R√©servations",
                isPhishing: false
            },
            {
                sender: "URGENCE@s√©curit√©.fr",
                name: "Service S√©curit√©",
                subject: "Compte compromis !",
                content: "Cher utilisateur,<br><br>Votre compte a √©t√© compromis. Action imm√©diate requise <a href='http://urgence-faux.com'>ici</a> pour s√©curiser votre compte.<br><br>Service S√©curit√©",
                isPhishing: true
            },
            {
                sender: "info@universite.com",
                name: "Universit√©",
                subject: "Informations sur la rentr√©e",
                content: "Cher √©tudiant,<br><br>Veuillez trouver ci-joint le planning de la rentr√©e universitaire.<br><br>Service Inscriptions",
                isPhishing: false
            },
            {
                sender: "admin@universite-faux.com",
                name: "Universit√© Support",
                subject: "Changement de mot de passe obligatoire",
                content: "Cher utilisateur,<br><br>Veuillez r√©initialiser votre mot de passe imm√©diatement <a href='http://reset-faux.com'>ici</a>.<br><br>Service Support",
                isPhishing: true
            },
            {
                sender: "banque@client.fr",
                name: "Banque",
                subject: "Relev√© bancaire mensuel",
                content: "Cher client,<br><br>Votre relev√© bancaire est disponible dans votre espace personnel.<br><br>Service Banque",
                isPhishing: false
            },
            {
                sender: "loterie@fakewin.com",
                name: "Loterie",
                subject: "F√©licitations ! Vous avez gagn√© !",
                content: "Cher utilisateur,<br><br>Vous avez gagn√© un prix ! Cliquez <a href='http://fauxgagnant.com'>ici</a> pour le r√©clamer.<br><br>Service Loterie",
                isPhishing: true
            },
            {
                sender: "contact@banque.fr",
                name: "Banque",
                subject: "Notification de virement re√ßu",
                content: "Cher client,<br><br>Un virement a √©t√© cr√©dit√© sur votre compte. Consultez votre espace client.<br><br>Service Banque",
                isPhishing: false
            },
            {
                sender: "s√©curit√©@banque.fr",
                name: "Service S√©curit√© Banque",
                subject: "Alerte de connexion suspecte",
                content: "Cher client,<br><br>Nous avons d√©tect√© une connexion suspecte √† votre compte. V√©rifiez imm√©diatement <a href='http://alerte-faux.com'>ici</a>.<br><br>Service S√©curit√©",
                isPhishing: true
            },
            {
                sender: "contact@club-sportif.com",
                name: "Club Sportif",
                subject: "Mise √† jour des horaires",
                content: "Cher membre,<br><br>Les horaires des entra√Ænements ont √©t√© mis √† jour. Consultez-les sur le site officiel.<br><br>Service Club Sportif",
                isPhishing: false
            },
            {
                sender: "apple-support@fauxapple.com",
                name: "Support Apple",
                subject: "Probl√®me de facturation",
                content: "Cher client,<br><br>Un probl√®me de facturation a √©t√© d√©tect√© sur votre compte Apple. R√©solvez-le <a href='http://apple-faux.com'>ici</a>.<br><br>Service Support",
                isPhishing: true
            },
            {
                sender: "noreply@linkedin.com",
                name: "LinkedIn",
                subject: "Nouvelle connexion √† votre compte",
                content: "Cher utilisateur,<br><br>Une nouvelle connexion a √©t√© d√©tect√©e. Si ce n'√©tait pas vous, changez votre mot de passe.<br><br>Service LinkedIn",
                isPhishing: false
            },
            {
                sender: "it-support@fauxentreprise.com",
                name: "Support IT Entreprise",
                subject: "Probl√®me technique d√©tect√©",
                content: "Cher utilisateur,<br><br>Un probl√®me technique a √©t√© d√©tect√©. Corrigez-le en cliquant <a href='http://probl√®me-tech-faux.com'>ici</a>.<br><br>Service IT",
                isPhishing: true
            },
            {
                sender: "communication@ecole.fr",
                name: "Ecole",
                subject: "Inscriptions ouvertes",
                content: "Cher √©tudiant,<br><br>Les inscriptions pour le semestre prochain sont ouvertes. Inscrivez-vous rapidement.<br><br>Service Inscriptions",
                isPhishing: false
            },
            {
                sender: "IT@entreprise-faux.com",
                name: "Service IT Entreprise",
                subject: "Maintenance syst√®me obligatoire",
                content: "Cher utilisateur,<br><br>Veuillez confirmer vos informations pour la mise √† jour <a href='http://it-faux.com'>ici</a>.<br><br>Service IT",
                isPhishing: true
            },
            {
                sender: "support@amazon.fr",
                name: "Support Amazon",
                subject: "Confirmation de commande",
                content: "Cher client,<br><br>Votre commande a √©t√© confirm√©e. Merci pour votre achat.<br><br>Service Clients",
                isPhishing: false
            },
            {
                sender: "s√©curit√©@paypal-faux.com",
                name: "S√©curit√© PayPal",
                subject: "Compte suspendu temporairement",
                content: "Cher utilisateur,<br><br>Votre compte est suspendu. R√©activez-le <a href='http://paypal-faux.com'>ici</a>.<br><br>Service S√©curit√©",
                isPhishing: true
            },
        ];
        let results = [];
        let eyeTrackingData = [];
        let startTime;
        
        webgazer.setGazeListener((data, timestamp) => {
            if (data) {
                eyeTrackingData.push({ x: data.x, y: data.y, timestamp: timestamp });
            }
        }).begin();

        function loadEmailList() {
            const emailList = document.getElementById("emailList");
            emailList.innerHTML = emails.map((email, index) => `
                <li onclick="displayEmail(${index})"> <strong>${email.name}</strong><br><small>${email.subject}</small></li>
            `).join('');
        }

        function getInitials(name) {
            return name.split(" ").map(word => word[0]).join("").toUpperCase();
        }
        
        function displayEmail(index) {
            startTime = Date.now(); // D√©marrer le chronom√®tre
            eyeTrackingData = []; // R√©initialiser les donn√©es eye-tracking
            const email = emails[index];
            document.getElementById("emailDisplay").innerHTML = `
                <div class="email-header">
                    <div class="email-avatar">${getInitials(email.name)}</div>
                    <div>
                        <strong>${email.name}</strong> <br>
                        <span style="color: gray;">${email.sender}</span>
                    </div>
                </div>
                <div class="email-subject">${email.subject}</div>
                <div class="email-content">${email.content}</div>
                <div class="likert-scale">
                    <span>1 (Pas suspect)</span>
                    ${[1, 2, 3, 4, 5, 6, 7].map(num => `
                        <label>
                            <input type="radio" name="likert" value="${num}">
                            ${num}
                        </label>
                    `).join('')}
                    <span>7 (Tr√®s suspect)</span>
                </div>
                <button class="submit-button" onclick="recordResponse(${index})">Soumettre</button>
            `;
        }

        function recordResponse(index) {
            const selectedValue = document.querySelector('input[name="likert"]:checked');
            if (!selectedValue) {
                alert("Veuillez s√©lectionner une valeur sur l'√©chelle.");
                return;
            }
            let reactionTime = Date.now() - startTime; // Calculer le temps de r√©action
            results.push({
                email: emails[index],
                "Temps de R√©action (ms)": reactionTime,
                "√âvaluation du risque (1-7)": selectedValue.value,
                EyeTracking: JSON.stringify(eyeTrackingData)
            });
            emails.splice(index, 1);
            loadEmailList();
            if (emails.length > 0) {
                document.getElementById("emailDisplay").innerHTML = "S√©lectionnez un email pour l'afficher.";
            } else {
                endExperiment();
            }
        }

        function endExperiment() {
            document.getElementById("emailDisplay").innerHTML = "Exp√©rience termin√©e, merci !";
            document.getElementById("downloadBtn").style.display = "block";
            webgazer.end();
        }

        function downloadExcel() {
            let ws = XLSX.utils.json_to_sheet(results);
            let wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "R√©sultats");
            XLSX.writeFile(wb, "resultats_experience.xlsx");
        }

        loadEmailList();
    </script>
</body>
</html>
