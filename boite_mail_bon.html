<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bo√Æte Mail - Exp√©rience de D√©tection de Phishing</title>
    <script src="https://cdn.jsdelivr.net/npm/webgazer/dist/webgazer.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.3/xlsx.full.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #e5e7eb;
            display: flex;
            height: 100vh;
            margin: 0;
        }
        .sidebar {
            width: 300px;
            background: #ffffff;
            border-right: 1px solid #ccc;
            padding: 20px;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            margin-top: 40vh; /* D√É¬©cale encore plus la sidebar vers le bas */
        }
        .email-list {
            list-style: none;
            padding: 0;
            margin: 0;
            overflow-y: auto;
            flex-grow: 1;
        }
        .email-list li {
            padding: 12px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background 0.3s;
        }
        .email-list li:hover {
            background: #f0f0f0;
        }
        .questionnaire-instructions {
            font-size: 18px;
            font-weight: bold;
            background-color: #f9f9f9;
            border-left: 5px solid #007bff;
            padding: 15px;
            margin-bottom: 25px;
            border-radius: 6px;
        }

        .questionnaire-scale-info {
            text-align: center;
            font-size: 14px;
            font-style: italic;
            margin-bottom: 20px;
            color: #555;
        }

        .email-content-container {
            flex-grow: 1;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            background: #e5e7eb;
        }
        .questionnaire-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 30px;
        }

        .questionnaire-table th,
        .questionnaire-table td {
            border: 1px solid #ccc;
            padding: 10px;
            text-align: center;
            font-size: 14px;
        }

        .questionnaire-table th {
            background-color: #f0f0f0;
            font-weight: bold;
        }

        .questionnaire-table td:first-child {
            text-align: left;
        }

        .questionnaire-instructions {
            font-size: 18px;
            font-weight: bold;
            background-color: #f9f9f9;
            border-left: 5px solid #007bff;
            padding: 15px;
            margin-bottom: 25px;
            border-radius: 6px;
        }

        .email-container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
            padding: 20px;
            width: 100%;
            max-width: 800px;
            margin-bottom: 20px;
        }

        .questionnaire-container {
            background: #ffffff;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            padding: 30px;
            width: 100%;
            max-width: 800px;
            text-align: left;
            margin-bottom: 20px;
            display: none;
        }

        .notation-container {
            background: #b0b3b8;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            padding: 20px;
            width: 100%;
            max-width: 800px;
            text-align: center;
            display: none;
        }
        .email-header {
            display: flex;
            align-items: center;
            margin-bottom: 50px;
        }
        .email-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: #4caf50;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 18px;
            font-weight: bold;
            margin-right: 50px;
        }
        .email-subject {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 40px;
        }
        .email-content {
            font-size: 15px;
            color: #444;
            line-height: 1.6;
            border-top: 1px solid #ddd;
            padding-top: 15px;
        }
        .email-signature {
            font-size: 15px;
            color: #444;
            font-weight: bold;
            margin-bottom: 15px;
        }
        .likert-scale {
            margin-top: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 15px;
            background: #f1f1f1;
            padding: 10px;
            border-radius: 8px;
        }
        .likert-scale label {
            cursor: pointer;
            padding: 5px;
            transition: 0.2s;
        }
        .likert-scale label:hover {
            background-color: #ddd;
            border-radius: 5px;
        }
        .submit-button {
            margin-top: 15px;
            padding: 12px;
            font-size: 16px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            width: 100%;
            font-weight: bold;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <h3>Bo√Æte de R√©ception</h3>
        <ul class="email-list" id="emailList"></ul>
    </div>
    <div class="email-content-container">
        <div id="emailDisplay" class="email-container">S√©lectionnez un email pour l'afficher.</div>
        <div id="questionnaireContainer" class="questionnaire-container">
            <form id="questionnaireForm">
                <button type="submit" class="submit-button" style="margin-bottom: 30px;">
                    Soumettre le questionnaire
                </button>
                <div id="questionnaireItems"></div>
            </form>
        </div>
        <div id="finalMessage" style="display: none; font-size: 18px; font-weight: bold; margin-bottom: 20px;">
            Exp√©rience termin√©e, merci !
        </div>
        <div id="personalityContainer" class="questionnaire-container" style="display: none;">
            <form id="personalityForm">
                <div class="questionnaire-instructions">
                    Veuillez lire attentivement chaque √©nonc√© et √©valuez √† quel point cet √©nonc√© vous d√©crit.
                    <br><br>
                    1 = Total d√©saccord &nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp; 5 = Total accord
                </div>
                <div id="personalityItems"></div>
                <div style="text-align: center;">
                    <button type="submit" class="submit-button">Soumettre le questionnaire</button>
                </div>
            </form>
        </div>

        <button id="downloadBtn" class="submit-button" onclick="downloadExcel()" style="display: none;">
            T√©l√©charger les r√©sultats
        </button>
        <div class="notation-container" id="notationContainer">
            <p>Evaluation du risque :</p>
            <div class="likert-scale" id="likertScale"></div>
            <button class="submit-button" onclick="recordResponse()">Soumettre</button>
        </div>
    </div>
    <script>
        let emails = [
            {
                sender: "support@google.fr",
                name: "Google Support",
                subject: "Alerte de s√©curit√©",
                content: "Bonjour,<br><br>Nous avons d√©tect√© une nouvelle connexion √† votre compte Google depuis un Windows. Si c'√©tait vous, aucune action de votre part n'est requise. Dans le cas contraire, nous vous aiderons √† s√©curiser votre compte. Vous pouvez aussi voir l'activit√© li√©e √† la s√©curit√© de votre compte en cliquant sur le lien ci-dessous.<br><br><a href='#'>Consulter l'activit√©</a><br><br>Cordialement,<br><br><br><br>XXXXXX<br>",
                signature: "L'√©quipe Google",
                isPhishing: false
            }, //0 cr√©dit 0 ortho (00)
            {
                sender: "admin@banque-arnaque.com",
                name: "Banque S√©curit√©",
                subject: "Probl√®me de s√©curit√©",
                content: "Cher client,<br><br>Nous avons remarqu√© une activit√© inhabituelle sur votre compte bancaire. Merci de mettre √† jour vos informations imm√©diatement.<br><br><a href='#'>Mettre √† jour</a><br><br><br>XXXXXX<br>",
                signature: "Service S√©curit√©",
                isPhishing: true
            }, //2 cr√©dit 0 ortho
            {
                sender: "support@airfrance.fr",
                name: "Support Air France",
                subject: "D√©tails de vautre vol",
                content: "Cher passag√©,<br><br>Voici les d√©tails de vautre vol r√©servait. Cliquez <a href='http://remboursement-faux.com'>ici</a> pour les voir. Bons voyage !<br><br>",
                signature: "Service Clients",
                isPhishing: false
            }, //0 cr√©dit 2 ortho
            {
                sender: "impots@gouv-faux.fr",
                name: "Administration fiscale",
                subject: "Frode d√©tectait sur votre dossi√© fiscal",
                content: "Cher contribuable,<br><br>Votre dossi√© fiscal est sou investigation. Prenait des mesures <a href='http://fraude-fiscale-faux.com'>ici</a>.<br><br>",
                signature: "Service Fiscalit√©",
                isPhishing: true
            }, //2 cr√©dit 2 ortho
            {
                sender: "no-reply@i.impots.gouv.fr",
                name: "Administration fiscale",
                subject: "Remboursement d'imp√¥ts disponible",
                content: "Cher contribuable,<br><br>Vous avez droit √† un remboursement. Cliquez <a href='http://remboursement-faux.com'>ici</a> pour le r√©clamer.<br><br>",
                signature: "Service Fiscalit√©",
                isPhishing: true
            },//1 cr√©dit 0 ortho
            {
                sender: "administration@universite.fr",
                name: "Universit√©",
                subject: "Confirmation d'inscription",
                content: "Cher √©tudiant,<br><br>Votre inscription pour le semestre est confirm√©e. Bonne continuation.<br><br>",
                signature: "Service Inscriptions",
                isPhishing: false
            },// (00)
            {
                sender: "RH@entreprise.com",
                name: "Ressources Humaines",
                subject: "R√©unions d'√©quipe programm√©e",
                content: "Bonjour,<br><br>Une r√©union est pr√©vu vendredi √† 10h. Merci de confirm√©e votre pr√©sence en cliquant <a href='http://dropbox-faux.com'>ici</a><br><br>",
                signature: "Service RH",
                isPhishing: false
            },//0 cr√©dit 1 ortho
            {
                sender: "support@fdrop.box.com",
                name: "Support Dropbox",
                subject: "Partage de fichiers en attente",
                content: "Cher utilisateur,<br><br>Un fichier importants vous √† √©t√© partag√©. Acc√©dez-y <a href='http://dropbox-faux.com'>ici</a>.<br><br>",
                signature: "Service Support",
                isPhishing: true
            },//1 cr√©dit 1 ortho
            {
                sender: "info@bibliotheque.fr",
                name: "Biblioth√®que",
                subject: "Rappel de retour de livres",
                content: "Cher lecteur,<br><br>N'oubliez pas de retourner vos livres avant la date limite.<br><br>",
                signature: "Service Biblioth√®que",
                isPhishing: false
            },// (00)
        ];

        const questionnaireItems = [
            "1. Avouer que vos go√ªts sont diff√©rents de ceux d‚Äôun ami.",
            "2. Aller camper en pleine nature.",
            "3. Parier une journ√©e de salaire aux courses de chevaux.",
            "4. Investir 10% de vos revenus annuels dans un fonds mutuel √† croissance mod√©r√©e.",
            "5. Boire abondamment lors d‚Äôune activit√© sociale.",
            "6. Tricher par un montant important dans votre d√©claration d‚Äôimp√¥t.",
            "7. √ätre en d√©saccord avec un symbole d‚Äôautorit√© sur une question importante.",
            "8. Parier une journ√©e de salaire lors d‚Äôune partie de poker √† enjeu important.",
            "9. Avoir une aventure avec un homme ou une femme mari√©(e).",
            "10. Pr√©senter le travail de quelqu‚Äôun d‚Äôautre comme √©tant le v√¥tre.",
            "11. Descendre une pente de ski exigeant une habilet√© plus grande que la v√¥tre.",
            "12. Investir 5% de vos revenus annuels dans des titres tr√®s sp√©culatifs.",
            "13. Faire de la descente en eau vive au printemps, quand le niveau de l‚Äôeau est √©lev√©.",
            "14. Parier une journ√©e de salaire sur le r√©sultat d‚Äôun √©v√©nement sportif.",
            "15. Avoir des relations sexuelles sans protection.",
            "16. R√©v√©ler le secret d‚Äôun ami √† un autre ami.",
            "17. Conduire une voiture sans porter de ceinture de s√©curit√©.",
            "18. Investir 10% de vos revenus annuels dans une nouvelle entreprise.",
            "19. Suivre un cours de parachutisme.",
            "20. Conduire une motocyclette sans casque protecteur.",
            "21. Choisir une carri√®re qui vous pla√Æt vraiment plut√¥t qu‚Äôune carri√®re s√©curitaire.",
            "22. Dire votre opinion sur une question controvers√©e lors d‚Äôune r√©union au travail.",
            "23. Vous faire bronzer sans √©cran solaire.",
            "24. Effectuer un saut √† l‚Äô√©lastique √† partir d‚Äôun pont √©lev√©.",
            "25. Piloter un petit avion.",
            "26. Rentrer chez vous √† pied le soir dans un quartier peu s√©curitaire.",
            "27. D√©m√©nager dans une ville √©loign√©e de votre famille.",
            "28. Entreprendre une nouvelle carri√®re au cours de la mi-trentaine.",
            "29. Laisser vos enfants seuls √† la maison pendant que vous faites une course.",
            "30. Ne pas retourner un portefeuille trouv√© contenant 200$."
        ];

        let questionnaireResponses = [];

        const personalityItems = [
            "1. Je suis le bout en train dans les partys.",
            "2. Je sympathise avec les sentiments des autres.",
            "3. J‚Äôaccomplis les t√¢ches m√©nag√®res sans d√©lai.",
            "4. J‚Äôai de fr√©quentes sautes d‚Äôhumeur.",
            "5. J‚Äôai une imagination fertile.",
            "6. Je ne parle pas beaucoup.",
            "7. Les probl√®mes des autres ne m'int√©ressent pas.",
            "8. J‚Äôoublie souvent de ranger les choses l√† o√π elles vont.",
            "9. Je suis d√©tendu la plupart du temps.",
            "10. Je n'ai pas d'int√©r√™t pour les id√©es abstraites.",
            "11. Je parle √† plusieurs personnes diff√©rentes dans les partys.",
            "12. Je ressens les √©motions des autres.",
            "13. J‚Äôaime l‚Äôordre.",
            "14. Je suis facilement contrari√©.",
            "15. J‚Äôai de la difficult√© √† comprendre les id√©es abstraites.",
            "16. J‚Äôai tendance √† rester en retrait.",
            "17. Je ne suis pas vraiment int√©ress√© par les autres.",
            "18. Je suis d√©sordonn√©.",
            "19. Je me sens rarement d√©prim√©.",
            "20. J‚Äôai tr√®s peu d‚Äôimagination."
        ];

        let personalityResponses = [];


        
        function sanitizeGaze(x, y) {
            const width = window.innerWidth;
            const height = window.innerHeight;

            x = Math.max(0, Math.min(x, width));
            y = Math.max(0, Math.min(y, height));

            return { x, y };
        }

        let results = [];
        let eyeTrackingData = [];
        let startTime;
        let currentEmailIndex = null;
        let zoneBoundaries = {}; // Stocke les limites des zones d'int√©r√™t

        // Fonction pour d√©finir les zones d'int√©r√™t sur la page
        function defineZones() {
            const emailDisplay = document.getElementById("emailDisplay");
            if (!emailDisplay) return;

            zoneBoundaries = {
                avatar: getElementBounds(".email-avatar"),
                expediteur: getElementBounds(".email-header div"),
                sujet: getElementBounds(".email-subject"),
                contenu: getElementBounds(".email-content"),
                signature: getElementBounds(".email-signature"),
                notation: getElementBounds(".notation-container")
            };
        }

        // Fonction pour r√©cup√©rer les coordonn√©es d'un √©l√©ment HTML
        function getElementBounds(selector) {
            const element = document.querySelector(selector);
            if (element) {
                const rect = element.getBoundingClientRect();
                return { 
                    top: rect.top, 
                    bottom: rect.bottom, 
                    left: rect.left, 
                    right: rect.right 
                };
            }
            return null;
        }

        // Fonction pour classifier les points d'eyetracking en fonction des zones
        function categorizeGazePoint(x, y) {
            for (const [zone, bounds] of Object.entries(zoneBoundaries)) {
                if (bounds && x >= bounds.left && x <= bounds.right && y >= bounds.top && y <= bounds.bottom) {
                    return zone;
                }
            }
            return "autre";
        }
        
        // Capture des donn√©es eye-tracking et classification des points
        webgazer.setGazeListener((data, timestamp) => {
            if (data) {
                const sanitized = sanitizeGaze(data.x, data.y);
                const zone = categorizeGazePoint(sanitized.x, sanitized.y); // Associe le point √† une zone
                eyeTrackingData.push({ x: sanitized.x, y: sanitized.y, zone, timestamp });
            }
        }).begin();

        function loadEmailList() {
            const emailList = document.getElementById("emailList");
            emailList.innerHTML = emails.map((email, index) => `
                <li onclick="displayEmail(${index})"> <strong>${email.name}</strong><br><small>${email.subject}</small></li>
            `).join('');

            if (emails.length === 0) {
                document.getElementById("downloadBtn").classList.remove("hidden");
                document.getElementById("emailDisplay").innerHTML = "Tous les emails ont √©t√© not√©s.";
                document.getElementById("notationContainer").style.display = "none";
            }
        }


        function getInitials(name) {
            return name.split(" ").map(word => word[0]).join("").toUpperCase();
        }
        
        function displayEmail(index) {
            startTime = Date.now(); // D√É¬©marrer le chronom√É¬®tre
            eyeTrackingData = []; // R√É¬©initialiser les donn√É¬©es eye-tracking
            currentEmailIndex = index;
            const email = emails[index];
            document.getElementById("emailDisplay").innerHTML = `
                <div class="email-header">
                    <div class="email-avatar">${getInitials(email.name)}</div>
                    <div>
                        <strong>${email.name}</strong> <br>
                        <span style="color: gray;">${email.sender}</span>
                    </div>
                </div>
                <div class="email-subject">${email.subject}</div>
                <div class="email-content">${email.content}</div>
                <div class="email-signature">${email.signature}</div>
            `;
            document.getElementById("notationContainer").style.display = "block";
            generateLikertScale();
            setTimeout(defineZones, 500); // Attendre le rendu de l'email avant d'analyser
        }

        function generateLikertScale() {
            document.getElementById("likertScale").innerHTML = `
                <span>1 (Pas suspect)</span>
                ${[1, 2, 3, 4, 5, 6, 7].map(num => `<label><input type="radio" name="likert" value="${num}"> ${num}</label>`).join('')}
                <span>7 (Tr√®s suspect)</span>
            `;
        }

        function recordResponse(index) {
            const selectedValue = document.querySelector('input[name="likert"]:checked');
            if (!selectedValue) {
                alert("Veuillez s√©lectionner une valeur sur l'√©chelle.");
                return;
            }
            let reactionTime = Date.now() - startTime; // Calculer le temps de r√É¬©action
            results.push({
                email: emails[currentEmailIndex].sender,
                "Temps de R√©action (ms)": reactionTime,
                "√âvaluation du risque (1-7)": selectedValue.value,
                EyeTracking: JSON.stringify(eyeTrackingData)
            });
            emails.splice(currentEmailIndex, 1);
            currentEmailIndex = null;
            document.getElementById("notationContainer").style.display = "none";
            loadEmailList();
            if (emails.length > 0) { //PAS MODIF
                document.getElementById("emailDisplay").innerHTML = "S√©lectionnez un email pour l'afficher.";
            } else {
                endExperiment();
            }
        }

        function generateQuestionnaire() {
            const container = document.getElementById("questionnaireItems");
            container.innerHTML = "";

            const instructions = `
                <div class="questionnaire-instructions">
                    Merci de r√©pondre au questionnaire suivant. Pour chaque √©nonc√©, indiquez √† quel point vous seriez susceptible d‚Äôagir ainsi :
                    <br><br>1 = Pas du tout risqu√© &nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp; 7 = Extr√™mement risqu√©
                </div>
            `;
            container.insertAdjacentHTML("beforebegin", instructions);

            let tableHTML = `
                <table class="questionnaire-table">
                    <thead>
                        <tr>
                            <th>Question</th>
                            ${[1, 2, 3, 4, 5, 6, 7].map(val => `<th>${val}</th>`).join('')}
                        </tr>
                    </thead>
                    <tbody>
                        ${questionnaireItems.map((question, index) => {
                            const id = `q${index + 1}`;
                            return `
                                <tr>
                                    <td><strong>${question}</strong></td>
                                    ${[1, 2, 3, 4, 5, 6, 7].map(val => `
                                        <td>
                                            <input type="radio" name="${id}" value="${val}" required>
                                        </td>
                                    `).join('')}
                                </tr>
                            `;
                        }).join('')}
                    </tbody>
                </table>
                <div style="text-align: center;">
                    <button type="submit" class="submit-button">
                        Soumettre le questionnaire
                    </button>
                </div>
            `;

            container.innerHTML = tableHTML;
        }


        function generatePersonalityQuestionnaire() {
            const container = document.getElementById("personalityItems");
            container.innerHTML = "";

            let tableHTML = `
                <table class="questionnaire-table">
                    <thead>
                        <tr>
                            <th>√ânonc√©</th>
                            ${[1, 2, 3, 4, 5].map(val => `<th>${val}</th>`).join('')}
                        </tr>
                    </thead>
                    <tbody>
                        ${personalityItems.map((question, index) => {
                            const id = `p${index + 1}`;
                            return `
                                <tr>
                                    <td><strong>${question}</strong></td>
                                    ${[1, 2, 3, 4, 5].map(val => `
                                        <td><input type="radio" name="${id}" value="${val}" required></td>
                                    `).join('')}
                                </tr>
                            `;
                        }).join('')}
                    </tbody>
                </table>
            `;

            container.innerHTML = tableHTML;
        }


        function endExperiment() {
            document.getElementById("notationContainer").style.display = "none";
            webgazer.end();

            setTimeout(() => {
                generateQuestionnaire();
                document.getElementById("questionnaireContainer").style.display = "block";
                document.getElementById("questionnaireContainer").scrollIntoView({ behavior: "smooth" });
            }, 300);
        }



        function downloadExcel() {
            let wb = XLSX.utils.book_new(); // Cr√©ation du fichier Excel

            // üîπ Premi√®re feuille : R√©sum√© des emails avec temps de r√©action et √©valuation
            let summaryData = results.map(result => ({
                "Email": result.email,
                "Temps de R√©action (ms)": result["Temps de R√©action (ms)"],
                "√âvaluation du Risque (1-7)": result["√âvaluation du risque (1-7)"]
            }));

            let wsSummary = XLSX.utils.json_to_sheet(summaryData);
            XLSX.utils.book_append_sheet(wb, wsSummary, "R√©sum√© G√©n√©ral");

            // üîπ Feuilles individuelles pour les donn√©es d'eyetracking de chaque email
            results.forEach(result => {
                let eyeTrackingData = JSON.parse(result.EyeTracking); // Convertir les donn√©es en objet
                let dataForSheet = [];

                // Transformer les donn√©es d'eyetracking en format tabulaire
                eyeTrackingData.forEach((point, index) => {
                    dataForSheet.push({
                        "Index": index + 1,
                        "Coordonn√©e X": point.x,
                        "Coordonn√©e Y": point.y,
                        "Zone d'Int√©r√™t": point.zone,
                        "Timestamp (ms)": point.timestamp
                    });
                });

                // Cr√©er une feuille sp√©cifique pour chaque email
                let ws = XLSX.utils.json_to_sheet(dataForSheet);
                let sheetName = result.email.substring(0, 30); // Limiter √† 30 caract√®res pour compatibilit√© Excel
                XLSX.utils.book_append_sheet(wb, ws, sheetName);
            });

            // üîπ Feuille "Questionnaire" (dans une feuille Excel s√©par√©e)
            if (questionnaireResponses.length > 0) {
                console.log("‚úÖ R√©ponses du questionnaire :", questionnaireResponses);
                let wsQuestionnaire = XLSX.utils.json_to_sheet(questionnaireResponses);
                XLSX.utils.book_append_sheet(wb, wsQuestionnaire, "Questionnaire");
            }

            if (personalityResponses.length > 0) {
                let wsPersonality = XLSX.utils.json_to_sheet(personalityResponses);
                XLSX.utils.book_append_sheet(wb, wsPersonality, "Personnalit√©");
            }


            // üîπ G√©n√©rer et t√©l√©charger le fichier Excel
            XLSX.writeFile(wb, "resultats_experience.xlsx");
            window.location.href = "ccalibrage.html";
        }

        loadEmailList();
        document.getElementById("questionnaireForm").addEventListener("submit", function(e) {
            e.preventDefault();

            const formData = new FormData(this);
            questionnaireResponses = questionnaireItems.map((question, i) => {
                const key = `q${i + 1}`;
                return {
                    Question: question,
                    R√©ponse: formData.get(key)
                };
            });

            console.log("R√©ponses questionnaire :", questionnaireResponses); // Optionnel

            document.getElementById("questionnaireContainer").style.display = "none";
            generatePersonalityQuestionnaire();
            document.getElementById("personalityContainer").style.display = "block";

        });

        document.getElementById("personalityForm").addEventListener("submit", function(e) {
            e.preventDefault();

            const formData = new FormData(this);
            personalityResponses = personalityItems.map((question, i) => {
                const key = `p${i + 1}`;
                return {
                    Question: question,
                    R√©ponse: formData.get(key)
                };
            });

            document.getElementById("personalityContainer").style.display = "none";
            document.getElementById("finalMessage").style.display = "block";
            document.getElementById("downloadBtn").style.display = "inline-block";
            document.getElementById("downloadBtn").disabled = false;
        });

    </script>
</body>
</html>
